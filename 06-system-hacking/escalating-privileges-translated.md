
# การยกระดับสิทธิ์ (Escalating Privileges)

- ใช้ประโยชน์จากช่องโหว่ของระบบปฏิบัติการและซอฟต์แวร์เพื่อรับสิทธิ์ผู้ดูแลระบบ
  - โดยทั่วไปโดยการรันโค้ดที่เป็นอันตรายที่ให้สิทธิ์ที่สูงขึ้น
- การเป็นผู้ดูแลระบบบนระบบเป้าหมายอนุญาตให้ทำกิจกรรมที่เป็นอันตรายทุกประเภทได้

## ประเภทของการยกระดับสิทธิ์

- **การยกระดับสิทธิ์ในแนวนอน (Horizontal Privilege Escalation)**
  - การได้มาซึ่งสิทธิ์ในระดับเดียวกัน
  - อนุญาตให้รันไฟล์จากตำแหน่งที่ควรได้รับการป้องกัน
- **การยกระดับสิทธิ์ในแนวตั้ง (Vertical Privilege Escalation)**
  - การได้มาซึ่งสิทธิ์ที่สูงขึ้น

## ตัวอย่างกระบวนการยกระดับสิทธิ์

- ![Flowchart for escalating privileges](./img/escalating-privileges.png)

## เทคนิคการยกระดับสิทธิ์

- **Path Interception**
  - สร้างไฟล์ในเส้นทางที่จะรันแทนเป้าหมายที่ถูกต้อง
  - ใช้ประโยชน์จากการกำหนดค่าผิดพลาด, เครื่องหมายคำพูด, ลำดับการค้นหา
- **Web Shell**
  - ติดตั้งเป็น backdoor เพื่อควบคุมจากเซิร์ฟเวอร์ระยะไกล
- `setuid` และ `setgid`
  - การตั้งค่าเหล่านี้ช่วยให้สามารถรันไฟล์ด้วยสิทธิ์ที่มากกว่าผู้ใช้ใน macOS และ Linux

### การหมุนเวียน (Pivoting)

- ใช้ระบบที่ถูกบุกรุกเป็นจุดเริ่มต้นในการโจมตีระบบอื่น
- เช่น ใน [Metasploit](./../05-vulnerabilities/automated-penetration-testing-tools.md#metasploit) คุณสามารถเพิ่มเส้นทางไปยังระบบที่ถูกบุกรุกครั้งแรกเพื่อเข้าถึงเครือข่ายที่อยู่เบื้องหลังมัน

### เทคนิค Windows

#### การจัดการโทเค็นการเข้าถึง (Access Token Manipulation)

- โทเค็นการเข้าถึงถูกใช้ใน Windows เป็น **บริบทความปลอดภัย** ของกระบวนการหรือเธรด
- ทุกกระบวนการที่ผู้ใช้รันจะได้รับโทเค็นที่ออกเพื่อการรับรองความถูกต้องของผู้ใช้
- ผู้ใช้สามารถแก้ไขโทเค็นได้เพื่อให้กระบวนการดูเหมือนเป็นของผู้ใช้อื่น
- เช่น "run as" รันเป็นผู้ดูแลระบบ จึงให้สิทธิ์ผู้ดูแลระบบ

#### ความอ่อนแอของสิทธิ์ในระบบไฟล์ (File System Permissions Weakness)

- ไฟล์ไบนารีใน Windows รันด้วยสิทธิ์ของกระบวนการที่รันมัน
- ไฟล์ไบนารีเดิมสามารถถูกแทนที่ด้วยไฟล์ที่เป็นอันตรายเพื่อรับสิทธิ์

#### Windows Application Shimming

- Shim = Windows Application Compatibility Framework
  - ชั้นความเข้ากันได้สำหรับเวอร์ชันใหม่กว่า/เก่ากว่าของ Windows
